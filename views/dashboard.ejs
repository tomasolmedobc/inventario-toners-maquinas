<!-- views/dashboard.ejs -->
<%- include('partials/header') %>

<div class="container mt-5">
  <h2 class="mb-4">Entradas y salidas de insumos</h2>

  <ul class="nav nav-tabs mb-3" id="dashboardTabs" role="tablist">
    <li class="nav-item" role="presentation">
      <button class="nav-link active" id="salidas-tab" data-bs-toggle="tab" data-bs-target="#salidas" type="button" role="tab">Historial de Salidas</button>
    </li>
    <li class="nav-item" role="presentation">
      <button class="nav-link" id="entradas-tab" data-bs-toggle="tab" data-bs-target="#entradas" type="button" role="tab">Historial de Entradas</button>
    </li>
  </ul>

  <div class="tab-content" id="dashboardTabsContent">

    <!-- SALIDAS -->
    <div class="tab-pane fade show active" id="salidas" role="tabpanel">
      <div class="d-flex mb-2">
        <input type="text" class="form-control me-2" id="busquedaSalidas" placeholder="Buscar...">
        <input type="date" class="form-control me-2" id="filtroFechaSalidas">
        <button class="btn btn-secondary me-2" id="prevSalidas">Anterior</button>
        <button class="btn btn-secondary" id="nextSalidas">Siguiente</button>
      </div>
      
      <table class="table table-striped" id="tablaSalidas">
        <thead class="table-dark">
          <tr>
            <th>Usuario</th>
            <th>√Årea</th>
            <th>Producto</th>
            <th>Marca</th>
            <th>Modelo</th>
            <th>Cantidad</th>
            <th>Fecha</th>
          </tr>
        </thead>
        <tbody>
          <% movimientos.filter(m => m.tipo === 'salida').forEach(mov => { %>
            <tr>
              <td><%= mov.usuario?.nombre || 'Sin usuario' %></td>
              <td><%= mov.area || '-' %></td>
              <td><%= mov.producto?.tipo || '-' %></td>
              <td><%= mov.producto?.marca || '-' %></td>
              <td><%= mov.producto?.modelo || '-' %></td>
              <td><%= mov.cantidad %></td>
              <td class="fecha" data-fecha="<%= new Date(mov.fecha).toISOString() %>">
                <%= new Date(mov.fecha).toLocaleDateString('es-AR') %>
              </td>
            </tr>
          <% }); %>
        </tbody>
      </table>
    </div>

    <!-- ENTRADAS -->
    <div class="tab-pane fade" id="entradas" role="tabpanel">
      <div class="d-flex mb-2">
        <input type="text" class="form-control me-2" id="busquedaEntradas" placeholder="Buscar por usuario, producto, marca...">
        <input type="date" class="form-control me-2" id="filtroFechaEntradas">
        <button class="btn btn-secondary me-2" id="prevEntradas">Anterior</button>
        <button class="btn btn-secondary" id="nextEntradas">Siguiente</button>
      </div>

      <table class="table table-striped" id="tablaEntradas">
        <thead class="table-dark">
          <tr>
            <th>Usuario</th>
            <th>Producto</th>
            <th>Marca</th>
            <th>Modelo</th>
            <th>Cantidad</th>
            <th>Fecha</th>
          </tr>
        </thead>
        <tbody>
          <% movimientos.filter(m => m.tipo === 'entrada').forEach(mov => { %>
            <tr>
              <td><%= mov.usuario?.nombre || 'Sin usuario' %></td>
              <td><%= mov.producto?.tipo || '-' %></td>
              <td><%= mov.producto?.marca || '-' %></td>
              <td><%= mov.producto?.modelo || '-' %></td>
              <td><%= mov.cantidad %></td>
              <td class="fecha" data-fecha="<%= new Date(mov.fecha).toISOString() %>">
                <%= new Date(mov.fecha).toLocaleDateString('es-AR') %>
              </td>
            </tr>
          <% }); %>
        </tbody>
      </table>
    </div>

  </div>
</div>

<script src="/resources/js/inventario.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="/resources/js/viewDashboard.js"></script>

<%- include('partials/footer') %>
